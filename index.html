<!DOCTYPE html>
<html>

<head>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
</head>

<body>

    <div class="page-header">
        <h1>Weather Report</h1>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div class="row">
                    <form>
                        <label>Search for a City:</label><br>
                        <input id="user-input" type="text"><br><br>
                        <button>
                            <i id="button" class="fas fa-search"></i>
                        </button>
                    </form>

                </div>
                <div class="row">
                    <table>
                        <tr>
                            <td id="Austin">Austin</td>
                        </tr>
                        <tr>
                            <td id="Baltimore">Baltimore</td>
                        </tr>
                        <tr>
                            <td id="Denver">Denver</td>
                        </tr>
                        <tr>
                            <td id="New-York">New York</td>
                        </tr>
                        <tr>
                            <td id="Los-Angeles">Los Angeles</td>
                        </tr>
                        <tr>
                            <td id="Detroit">Detroit</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="col-md-10">
                <!-- <div class="row"> -->

                <h1 id="city"></h1>
                <h2 id="temp">Temperature</h2>
                <h2 id="humid">Humidity</h2>
                <h2 id="wind">Wind Speed</h2>
                <h2 id="conditions">Weather Conditions</h2>
                <h2>UV Index: <span id="index"></span></h2>



                <!-- </div>
                 -->
                <!-- 5 bootstrap cards here -->
                <div class="card-container">
                    <div class="card" style="max-width: 10rem;">
                        <div class="card-header" id="card-1"></div>
                        <div class="card-body">
                            <h5 class="card-title">Primary card title</h5>
                            <p class="card-text">Icon, temp, humidity</p>
                        </div>
                    </div>
                    <div class="card" style="max-width: 10rem;">
                        <div class="card-header" id="card-2">day/date</div>
                        <div class="card-body">
                            <h5 class="card-title">Secondary card title</h5>
                            <p class="card-text">Icon, temp, humidity</p>
                        </div>
                    </div>
                    <div class="card" style="max-width: 10rem;">
                        <div class="card-header" id="card-3">day/date</div>
                        <div class="card-body">
                            <h5 class="card-title">Success card title</h5>
                            <p class="card-text">Icon, temp, humidity</p>
                        </div>
                    </div>
                    <div class="card" style="max-width: 10rem;">
                        <div class="card-header" id="card-4">day/date</div>
                        <div class="card-body">
                            <h5 class="card-title">Danger card title</h5>
                            <p class="card-text">Icon, temp, humidity</p>
                        </div>
                    </div>
                    <div class="card" style="max-width: 10rem;">
                        <div class="card-header" id="card-5">day/date</div>
                        <div class="card-body">
                            <h5 class="card-title">Warning card title</h5>
                            <p class="card-text">Icon, temp, humidity</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
    <script type="text/javascript">
        var dayOne = moment();
        var dayCardOne = document.getElementById("card-1");
        dayCardOne.innerHTML = dayOne.format("MM/DD/YYYY");
        var dayTwo = moment().add(1, "days");
        var dayCardTwo = document.getElementById("card-2");
        dayCardTwo.innerHTML = dayTwo.format("MM/DD/YYYY");
        var dayThree = moment().add(2, "days");
        var dayCardThree = document.getElementById("card-3");
        dayCardThree.innerHTML = dayThree.format("MM/DD/YYYY");
        var dayFour = moment().add(3, "days");
        var dayCardFour = document.getElementById("card-4");
        dayCardFour.innerHTML = dayFour.format("MM/DD/YYYY");
        var dayFive = moment().add(4, "days");
        var dayCardFive = document.getElementById("card-5");
        dayCardFive.innerHTML = dayFive.format("MM/DD/YYYY");
        // on button click, weather api is called to populate all info to page and stores city to local storage
        $("#button").on("click", function (event) {
            event.preventDefault();
            var userCity = $("#user-input").val();
            returnAll(userCity);



        })
        $("#Austin").on("click", function () {
            $.ajax({
                type: "GET",
                url: ""
            })
        })
        function index(lat, lon) {
            console.log(lat, lon, "inside UV Index");
            $.ajax({
                type: "GET",
                url: "http://api.openweathermap.org/data/2.5/uvi?appid=d3c897154ff62ec9770b10172a75be35&lat=" + lat + "&lon=" + lon,
                dataType: "json"
            }).then(function (response) {
                console.log(response);
                var index = response.value;
                $("#index").text(index)
                if (response.value < 3) {
                    $("#index").addClass("mild");
                    $("#index").removeClass("moderate");
                    $("#index").removeClass("severe");
                } else if (response.value > 3 && response.value < 7) {
                    $("#index").addClass("moderate");
                    $("#index").removeClass("mild");
                    $("#index").removeClass("severe");
                } else {
                    $("#index").addClass("severe");
                    $("#index").removeClass("moderate");
                    $("#index").removeClass("mild");
                }
            })
        }

        // gets city back from local storage and places in user input
        function getLatestSearch() {
            if (localStorage != null);
            document.getElementById("user-input").value = localStorage.getItem("#user-input");
            console.log(document.getElementById("user-input").value)
            returnAll(document.getElementById("user-input").value);
        }
        // returns all info to page via most recent city storage by doing ajax call again
        function returnAll(userCity) {
            // var userCity = $("#user-input").val();
            var queryURL = "http://api.openweathermap.org/data/2.5/weather?q=" + userCity + "&units=imperial&appid=d3c897154ff62ec9770b10172a75be35"

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {
                console.log(response);
                var temp = response.main.temp;
                $("#temp").text("Temperature: " + temp + "Â°F");
                var humidity = response.main.humidity;
                $("#humid").text("Humidity: " + humidity + "%");
                var wind = response.wind.speed;
                $("#wind").text("Wind Speed: " + wind + "mph");
                var conditions = response.weather[0].main;
                $("#conditions").text("Weather Conditions: " + conditions);
                var city = response.name;
                $("#city").text(city);
                var city = document.getElementById("user-input").value;
                localStorage.setItem("#user-input", city);
                var latitude = response.coord.lat;
                var longitude = response.coord.lon;
                index(latitude, longitude);
                console.log(latitude, longitude);
            })
        }
        // call function getlatestsearch to put city into input field
        getLatestSearch();
        // and then get all weather info for city by calling function returnAll
        // returnAll(userCity);
    </script>
</body>

</html>